# -*- coding: utf-8 -*-
import scrapy
from myscrapy.items import MyscrapyItem
from scrapy_redis.spiders import RedisSpider


# class QianchengSpider(scrapy.Spider):
class QianchengSpider(RedisSpider):
    # 项目名
    name = 'slave'
    #allowed_domains = ['51jobs.com']
    # 起始网页，有起始网页的话则直接发起请求，响应返回给self.parse解析
    # 无start_urls则需要创建start_requests(self)方法创建url
    # start_urls = ['http://www.51job.com/']
    city ={'北京': '010000', '东城区': '030803', '西城区': '010200', '朝阳区': '240201', '丰台区': '010600', '石景山区': '010700', '海淀区': '010800', '门头沟区': '010900', '房山区': '011000', '通州区': '011100', '顺义区': '011200', '昌平区': '011300', '大兴区': '011400', '怀柔区': '011500', '平谷区': '011600', '密云区': '011700', '延庆区': '011800', '上海': '020000', '黄浦区': '020100', '徐汇区': '020300', '长宁区': '020400', '静安区': '020500', '普陀区': '020600', '虹口区': '020800', '杨浦区': '020900', '浦东新区': '021000', '闵行区': '021100', '宝山区': '021200', '嘉定区': '021300', '金山区': '021400', '松江区': '021500', '青浦区': '021600', '奉贤区': '021800', '崇明区': '021900', '广东省': '030000', '广州': '030200', '越秀区': '030201', '荔湾区': '030202', '海珠区': '030203', '天河区': '030204', '白云区': '030205', '黄埔区': '030206', '番禺区': '030207', '花都区': '030208', '南沙区': '030209', '增城': '030211', '从化': '030212', '惠州': '030300', '汕头': '030400', '珠海': '030500', '香洲区': '030501', '斗门区': '030502', '金湾区': '030503', '横琴新区': '030504', '高栏港经济区': '030505', '珠海高新区': '030506', '珠海保税区': '030507', '万山海洋开发试验区': '030508', '佛山': '030600', '禅城区': '030601', '顺德区': '030602', '南海区': '030603', '三水区': '030604', '高明区': '030605', '中山': '030700', '东莞': '030800', '莞城区': '030801', '南城区': '030802', '万江区': '030804', '石碣镇': '030805', '石龙镇': '030806', '茶山镇': '030807', '石排镇': '030808', '企石镇': '030809', '横沥镇': '030810', '桥头镇': '030811', '谢岗镇': '030812', '东坑镇': '030813', '常平镇': '030814', '寮步镇': '030815', '大朗镇': '030816', '麻涌镇': '030817', '中堂镇': '030818', '高埗镇': '030819', '樟木头镇': '030820', '大岭山镇': '030821', '望牛墩镇': '030822', '黄江镇': '030823', '洪梅镇': '030824', '清溪镇': '030825', '沙田镇': '030826', '道滘镇': '030827', '塘厦镇': '030828', '虎门镇': '030829', '厚街镇': '030830', '凤岗镇': '030831', '长安镇': '030832', '松山湖区': '030833', '韶关': '031400', '江门': '031500', '湛江': '031700', '肇庆': '031800', '清远': '031900', '潮州': '032000', '河源': '032100', '揭阳': '032200', '茂名': '032300', '汕尾': '032400', '梅州': '032600', '开平': '032700', '阳江': '032800', '云浮': '032900', '深圳': '040000', '福田区': '040100', '罗湖区': '040200', '南山区': '040300', '盐田区': '040400', '宝安区': '040500', '龙岗区': '040600', '光明新区': '040700', '坪山区': '040800', '大鹏新区': '040900', '龙华新区': '041000', '天津': '050000', '和平区': '230204', '河东区': '050200', '河西区': '050300', '南开区': '050400', '河北区': '050500', '红桥区': '050600', '东丽区': '050700', '西青区': '050800', '津南区': '050900', '北辰区': '051000', '武清区': '051100', '宝坻区': '051200', '滨海新区': '051300', '宁河区': '051400', '静海区': '051500', '蓟州区': '051600', '重庆': '060000', '渝中区': '060100', '大渡口区': '060200', '江北区': '080303', '沙坪坝区': '060400', '合川区': '060600', '渝北区': '060700', '永川区': '060800', '巴南区': '060900', '南川区': '061000', '九龙坡区': '061100', '万州区': '061200', '涪陵区': '061300', '黔江区': '061400', '南岸区': '061500', '北碚区': '061600', '长寿区': '061700', '江津区': '061900', '綦江区': '062000', '潼南区': '062100', '铜梁区': '062200', '大足区': '062300', '荣昌区': '062400', '璧山区': '062500', '垫江县': '062600', '丰都县': '062700', '忠县': '062800', '石柱县': '062900', '城口县': '063000', '彭水县': '063100', '梁平区': '063200', '酉阳县': '063300', '开州区': '063400', '秀山县': '063500', '巫溪县': '063600', '巫山县': '063700', '奉节县': '063800', '武隆区': '063900', '云阳县': '064000', '江苏省': '070000', '南京': '070200', '玄武区': '070201', '秦淮区': '070203', '建邺区': '070204', '鼓楼区': '110201', '浦口区': '070207', '六合区': '070208', '栖霞区': '070209', '雨花台区': '070210', '江宁区': '070211', '溧水区': '070212', '高淳区': '070213', '苏州': '070300', '姑苏区': '070301', '吴中区': '070303', '相城区': '070304', '吴江区': '070305', '工业园区': '070306', '高新区': '170214', '无锡': '070400', '梁溪区': '070401', '滨湖区': '070404', '无锡新区': '070405', '惠山区': '070406', '锡山区': '070407', '宜兴市': '070408', '江阴市': '070409', '常州': '070500', '天宁区': '070501', '钟楼区': '070502', '新北区': '070504', '武进区': '070505', '金坛区': '070506', '溧阳市': '070507', '昆山': '070600', '常熟': '070700', '扬州': '070800', '南通': '070900', '镇江': '071000', '徐州': '071100', '连云港': '071200', '盐城': '071300', '张家港': '071400', '太仓': '071600', '泰州': '071800', '淮安': '071900', '宿迁': '072000', '丹阳': '072100', '泰兴': '072300', '靖江': '072500', '浙江省': '080000', '杭州': '080200', '拱墅区': '080201', '上城区': '080202', '下城区': '080203', '江干区': '080204', '西湖区': '130202', '滨江区': '080206', '余杭区': '080207', '萧山区': '080208', '临安区': '080209', '富阳区': '080210', '建德市': '080211', '桐庐县': '080212', '淳安县': '080213', '宁波': '080300', '海曙区': '080301', '北仑区': '080304', '镇海区': '080305', '鄞州区': '080306', '慈溪市': '080307', '余姚市': '080308', '奉化区': '080309', '宁海县': '080310', '象山县': '080311', '温州': '080400', '绍兴': '080500', '金华': '080600', '嘉兴': '080700', '台州': '080800', '湖州': '080900', '丽水': '081000', '舟山': '081100', '衢州': '081200', '义乌': '081400', '海宁': '081600', '四川省': '090000', '成都': '090200', '青羊区': '090201', '锦江区': '090202', '金牛区': '090203', '武侯区': '090204', '成华区': '090205', '龙泉驿区': '090206', '青白江区': '090207', '新都区': '090208', '温江区': '090209', '都江堰市': '090210', '彭州市': '090211', '邛崃市': '090212', '崇州市': '090213', '金堂县': '090214', '双流区': '090215', '郫都区': '090216', '大邑县': '090217', '蒲江县': '090218', '新津县': '090219', '简阳市': '090221', '绵阳': '090300', '乐山': '090400', '泸州': '090500', '德阳': '090600', '宜宾': '090700', '自贡': '090800', '内江': '090900', '攀枝花': '091000', '南充': '091100', '眉山': '091200', '广安': '091300', '资阳': '091400', '遂宁': '091500', '广元': '091600', '达州': '091700', '雅安': '091800', '西昌': '091900', '巴中': '092000', '甘孜': '092100', '阿坝': '092200', '凉山': '092300', '海南省': '100000', '海口': '100200', '三亚': '100300', '洋浦经济开发区': '100400', '文昌': '100500', '琼海': '100600', '万宁': '100700', '儋州': '100800', '东方': '100900', '五指山': '101000', '定安': '101100', '屯昌': '101200', '澄迈': '101300', '临高': '101400', '三沙': '101500', '琼中': '101600', '保亭': '101700', '白沙': '101800', '昌江': '101900', '乐东': '102000', '陵水': '102100', '福建省': '110000', '福州': '110200', '台江区': '110202', '仓山区': '110203', '马尾区': '110204', '晋安区': '110205', '闽侯县': '110206', '连江县': '110207', '罗源县': '110208', '闽清县': '110209', '永泰县': '110210', '平潭县': '110211', '福清市': '110212', '长乐市': '110213', '厦门': '110300', '泉州': '110400', '漳州': '110500', '莆田': '110600', '三明': '110700', '南平': '110800', '宁德': '110900', '龙岩': '111000', '山东省': '120000', '济南': '120200', '历下区': '120201', '市中区': '120202', '槐荫区': '120203', '天桥区': '120204', '历城区': '120205', '长清区': '120206', '平阴县': '120207', '济阳县': '120208', '商河县': '120209', '章丘区': '120210', '青岛': '120300', '市南区': '120301', '市北区': '120302', '黄岛区': '120303', '崂山区': '120304', '城阳区': '120305', '李沧区': '120306', '胶州市': '120307', '即墨区': '120308', '平度市': '120309', '莱西市': '120310', '烟台': '120400', '潍坊': '120500', '威海': '120600', '淄博': '120700', '临沂': '120800', '济宁': '120900', '东营': '121000', '泰安': '121100', '日照': '121200', '德州': '121300', '菏泽': '121400', '滨州': '121500', '枣庄': '121600', '聊城': '121700', '莱芜': '121800', '江西省': '130000', '南昌': '130200', '东湖区': '130201', '青云谱区': '130203', '湾里区': '130204', '青山湖区': '130205', '南昌县': '130206', '新建区': '130207', '安义县': '130208', '进贤县': '130209', '红谷滩新区': '130210', '九江': '130300', '景德镇': '130400', '萍乡': '130500', '新余': '130600', '鹰潭': '130700', '赣州': '130800', '吉安': '130900', '宜春': '131000', '抚州': '131100', '上饶': '131200', '广西': '140000', '南宁': '140200', '桂林': '140300', '柳州': '140400', '北海': '140500', '玉林': '140600', '梧州': '140700', '防城港': '140800', '钦州': '140900', '贵港': '141000', '百色': '141100', '河池': '141200', '来宾': '141300', '崇左': '141400', '贺州': '141500', '安徽省': '150000', '合肥': '150200', '瑶海区': '150201', '庐阳区': '150202', '蜀山区': '150203', '包河区': '150204', '经开区': '170215', '滨湖新区': '150206', '新站区': '150207', '政务区': '150209', '北城新区': '150210', '巢湖市': '150211', '长丰县': '150212', '肥东县': '150213', '肥西县': '150214', '庐江县': '150215', '芜湖': '150300', '安庆': '150400', '马鞍山': '150500', '蚌埠': '150600', '阜阳': '150700', '铜陵': '150800', '滁州': '150900', '黄山': '151000', '淮南': '151100', '六安': '151200', '宣城': '151400', '池州': '151500', '宿州': '151600', '淮北': '151700', '亳州': '151800', '河北省': '160000', '雄安新区': '160100', '石家庄': '160200', '廊坊': '160300', '保定': '160400', '唐山': '160500', '秦皇岛': '160600', '邯郸': '160700', '沧州': '160800', '张家口': '160900', '承德': '161000', '邢台': '161100', '衡水': '161200', '燕郊开发区': '161300', '河南省': '170000', '郑州': '170200', '中原区': '170201', '二七区': '170202', '管城回族区': '170203', '金水区': '170204', '上街区': '170205', '惠济区': '170206', '中牟县': '170207', '巩义市': '170208', '荥阳市': '170209', '新密市': '170210', '新郑市': '170211', '登封市': '170212', '郑东新区': '170213', '郑州航空港区': '170216', '洛阳': '170300', '开封': '170400', '焦作': '170500', '南阳': '170600', '新乡': '170700', '周口': '170800', '安阳': '170900', '平顶山': '171000', '许昌': '171100', '信阳': '171200', '商丘': '171300', '驻马店': '171400', '漯河': '171500', '濮阳': '171600', '鹤壁': '171700', '三门峡': '171800', '济源': '171900', '邓州': '172000', '湖北省': '180000', '武汉': '180200', '江岸区': '180201', '江汉区': '180202', '硚口区': '180203', '汉阳区': '180204', '武昌区': '180205', '青山区': '180206', '洪山区': '180207', '东西湖区': '180208', '汉南区': '180209', '蔡甸区': '180210', '江夏区': '180211', '黄陂区': '180212', '新洲区': '180213', '武汉经济开发区': '180214', '东湖新技术产业开发区': '180215', '宜昌': '180300', '黄石': '180400', '襄阳': '180500', '十堰': '180600', '荆州': '180700', '荆门': '180800', '孝感': '180900', '鄂州': '181000', '黄冈': '181100', '随州': '181200', '咸宁': '181300', '仙桃': '181400', '潜江': '181500', '天门': '181600', '神农架': '181700', '恩施': '181800', '湖南省': '190000', '长沙': '190200', '芙蓉区': '190201', '天心区': '190202', '岳麓区': '190203', '开福区': '190204', '雨花区': '190205', '望城区': '190206', '长沙县': '190207', '宁乡县': '190208', '浏阳市': '190209', '株洲': '190300', '湘潭': '190400', '衡阳': '190500', '岳阳': '190600', '常德': '190700', '益阳': '190800', '郴州': '190900', '邵阳': '191000', '怀化': '191100', '娄底': '191200', '永州': '191300', '张家界': '191400', '湘西': '191500', '陕西省': '200000', '西安': '200200', '莲湖区': '200201', '新城区': '200202', '碑林区': '200203', '灞桥区': '200204', '未央区': '200205', '雁塔区': '200206', '阎良区': '200207', '临潼区': '200208', '长安区': '200209', '蓝田县': '200210', '周至县': '200211', '鄠邑区': '200212', '高陵区': '200213', '高新技术产业开发区': '240208', '经济技术开发区': '240207', '曲江文化新区': '200216', '浐灞生态区': '200217', '国家民用航天产业基地': '200218', '西咸新区': '200219', '西安阎良航空基地': '200220', '西安国际港务区': '200221', '咸阳': '200300', '宝鸡': '200400', '铜川': '200500', '延安': '200600', '渭南': '200700', '榆林': '200800', '汉中': '200900', '安康': '201000', '商洛': '201100', '杨凌': '201200', '山西省': '210000', '太原': '210200', '运城': '210300', '大同': '210400', '临汾': '210500', '长治': '210600', '晋城': '210700', '阳泉': '210800', '朔州': '210900', '晋中': '211000', '忻州': '211100', '吕梁': '211200', '黑龙江省': '220000', '哈尔滨': '220200', '道里区': '220201', '南岗区': '220202', '道外区': '220203', '平房区': '220204', '松北区': '220205', '香坊区': '220206', '呼兰区': '220207', '阿城区': '220208', '依兰县': '220209', '方正县': '220210', '宾县': '220211', '巴彦县': '220212', '木兰县': '220213', '通河县': '220214', '延寿县': '220215', '双城区': '220216', '尚志市': '220217', '五常市': '220218', '伊春': '220300', '绥化': '220400', '大庆': '220500', '齐齐哈尔': '220600', '牡丹江': '220700', '佳木斯': '220800', '鸡西': '220900', '鹤岗': '221000', '双鸭山': '221100', '黑河': '221200', '七台河': '221300', '大兴安岭': '221400', '辽宁省': '230000', '沈阳': '230200', '大东区': '230201', '浑南区': '230202', '康平县': '230203', '皇姑区': '230205', '沈北新区': '230206', '沈河区': '230207', '苏家屯区': '230208', '铁西区': '230209', '于洪区': '230210', '法库县': '230211', '辽中区': '230212', '新民市': '230213', '大连': '230300', '西岗区': '230301', '中山区': '230302', '沙河口区': '230303', '甘井子区': '230304', '旅顺口区': '230305', '金州区': '230306', '瓦房店市': '230307', '普兰店区': '230308', '庄河市': '230309', '长海县': '230310', '高新园区': '230312', '长兴岛': '230313', '大连保税区': '230314', '鞍山': '230400', '营口': '230500', '抚顺': '230600', '锦州': '230700', '丹东': '230800', '葫芦岛': '230900', '本溪': '231000', '辽阳': '231100', '铁岭': '231200', '盘锦': '231300', '朝阳': '231400', '阜新': '231500', '吉林省': '240000', '长春': '240200', '南关区': '240202', '宽城区': '240203', '二道区': '240204', '绿园区': '240205', '双阳区': '240206', '净月经济开发区': '240209', '汽车产业开发区': '240210', '榆树市': '240211', '九台区': '240212', '德惠市': '240213', '农安县': '240214', '吉林': '240300', '辽源': '240400', '通化': '240500', '四平': '240600', '松原': '240700', '延吉': '240800', '白山': '240900', '白城': '241000', '延边': '241100', '云南省': '250000', '昆明': '250200', '五华区': '250201', '盘龙区': '250202', '官渡区': '250203', '西山区': '250204', '东川区': '250205', '呈贡区': '250206', '晋宁区': '250207', '富民县': '250208', '宜良县': '250209', '石林彝族自治县': '250210', '嵩明县': '250211', '禄劝县': '250212', '寻甸县': '250213', '安宁市': '250214', '曲靖': '250300', '玉溪': '250400', '大理': '250500', '丽江': '250600', '红河州': '251000', '普洱': '251100', '保山': '251200', '昭通': '251300', '文山': '251400', '西双版纳': '251500', '德宏': '251600', '楚雄': '251700', '临沧': '251800', '怒江': '251900', '迪庆': '252000', '贵州省': '260000', '贵阳': '260200', '遵义': '260300', '六盘水': '260400', '安顺': '260500', '铜仁': '260600', '毕节': '260700', '黔西南': '260800', '黔东南': '260900', '黔南': '261000', '甘肃省': '270000', '兰州': '270200', '金昌': '270300', '嘉峪关': '270400', '酒泉': '270500', '天水': '270600', '武威': '270700', '白银': '270800', '张掖': '270900', '平凉': '271000', '定西': '271100', '陇南': '271200', '庆阳': '271300', '临夏': '271400', '甘南': '271500', '内蒙古': '280000', '呼和浩特': '280200', '赤峰': '280300', '包头': '280400', '通辽': '280700', '鄂尔多斯': '280800', '巴彦淖尔': '280900', '乌海': '281000', '呼伦贝尔': '281100', '乌兰察布': '281200', '兴安盟': '281300', '锡林郭勒盟': '281400', '阿拉善盟': '281500', '宁夏': '290000', '银川': '290200', '吴忠': '290300', '中卫': '290400', '石嘴山': '290500', '固原': '290600', '西藏': '300000', '拉萨': '300200', '日喀则': '300300', '林芝': '300400', '山南': '300500', '昌都': '300600', '那曲': '300700', '阿里': '300800', '新疆': '310000', '乌鲁木齐': '310200', '克拉玛依': '310300', '喀什地区': '310400', '伊犁': '310500', '阿克苏': '310600', '哈密': '310700', '石河子': '310800', '阿拉尔': '310900', '五家渠': '311000', '图木舒克': '311100', '昌吉': '311200', '阿勒泰': '311300', '吐鲁番': '311400', '塔城': '311500', '和田': '311600', '克孜勒苏柯尔克孜': '311700', '巴音郭楞': '311800', '博尔塔拉': '311900', '青海省': '320000', '西宁': '320200', '海东': '320300', '海西': '320400', '海北': '320500', '黄南': '320600', '海南': '320700', '果洛': '320800', '玉树': '320900', '香港': '330000', '澳门': '340000', '台湾': '350000', '国外': '360000', '亚洲': '361000', '日本': '361001', '韩国': '361002', '马来西亚': '361003', '新加坡': '361004', '泰国': '361005', '菲律宾': '361006', '印度尼西亚': '361007', '斯里兰卡': '361008', '印度': '361009', '缅甸': '361010', '越南': '361011', '朝鲜': '361012', '哈萨克斯坦': '361013', '乌兹别克斯坦': '361014', '伊朗': '361015', '伊拉克': '361016', '阿富汗': '361017', '巴基斯坦': '361018', '土耳其': '361019', '科威特': '361020', '沙特阿拉伯': '361021', '蒙古': '361022', '孟加拉国': '361023', '欧洲': '362000', '英国': '362001', '法国': '362002', '德国': '362003', '意大利': '362004', '西班牙': '362005', '葡萄牙': '362006', '爱尔兰': '362007', '波兰': '362008', '挪威': '362009', '瑞典': '362010', '芬兰': '362011', '奥地利': '362012', '乌克兰': '362013', '白俄罗斯': '362014', '保加利亚': '362015', '罗马尼亚': '362016', '匈牙利': '362017', '希腊': '362018', '俄罗斯': '362019', '瑞士': '362020', '丹麦': '362021', '比利时': '362022', '荷兰': '362023', '美洲': '363000', '美国': '363001', '加拿大': '363002', '墨西哥': '363003', '巴西': '363004', '阿根廷': '363005', '智利': '363006', '秘鲁': '363007', '哥伦比亚': '363008', '委内瑞拉': '363009', '玻利维亚': '363010', '非洲': '364000', '埃及': '364001', '南非': '364002', '苏丹': '364003', '阿尔及利亚': '364004', '埃塞俄比亚': '364005', '肯尼亚': '364006', '赞比亚': '364007', '坦桑尼亚': '364008', '马达加斯加': '364009', '莫桑比克': '364010', '安哥拉': '364011', '加纳': '364012', '摩洛哥': '364013', '尼日利亚': '364014', '大洋洲': '365000', '澳大利亚': '365001', '新西兰': '365002', '其他': '366000', '珠三角': '01'}
    '''
        调用类方法from_settings(cls,settings)，返回该类的实例
        instan = MyscrapyPipeline.from_xxx(cls,settings)
        使用返回值（实例）调用process_item实例方法
        instan.process_item(item,spider)
        or

        @classmethod
        from_crawler(cls, crawler):
            return MyscrapyPipeline(value=crawler.settings.get("key"))
        '''
    # 起始发起请求
    # def start_requests(self):
    #     '''
    #     (self, url（请求url）, callback = None（解析函数）, method = 'GET', headers = None（请求头部）, body = None,
    #     cookies = None（cookies）, meta = None（特殊字典【proxy：代理id，bindaddress：请求出发ip】）, encoding = 'utf-8',
    #     priority = 0,dont_filter = False(不去重url), errback = None（异常处理函数）, flags = None)
    #     '''
    #     print("master")
    #     find=input("岗位(python)>>>")
    #     if find == "":
    #         find = "python"
    #     else:
    #         find=find.strip()
    #     where=input("区域(广州)>>>")
    #     if where == "":
    #         where = "030200"
    #     else:
    #         where = QianchengSpider.city[where.strip()]
    #     url="http://search.51job.com/list/" + where + ",000000,0000,00,9,99,"+ find + ",2,1.html/"
    #     yield scrapy.Request(url=url, encoding='gbk', callback=self.parse,
    #                          errback=self.spidererr,dont_filter=False)



        # yield scrapy.FormRequest(url = ,fromdata = ,)
        # url=""发起post请求的url，formdata={}提交表单的数据


    # 起始网页解析处理
    '''
    response[url,status,headers]
    response.xpath("//table[@class='tablelist']//tr").extract()[0]
    获取标签文本则需要提取extract
    '''

    def parse(self, response):
        # item["name"]='abc'
        urls = response.xpath("//div[@class='el']//a[@onmousedown]/@href").extract()
        for i in urls:
            yield scrapy.Request(url=i, encoding='gbk', callback=self.qianchengparse,
                                 errback=self.parseerror,dont_filter=False)

        # return None

    def qianchengparse(self , response):
        '''
            gangwei = scrapy.Field()#岗位
            yaoqiu = scrapy.Field()#要求
            xinchou = scrapy.Field()#薪酬
            zhize = scrapy.Field()#职责
            diqu = scrapy.Field()#地区
            dizhi = scrapy.Field()#地址
            gongsi = scrapy.Field()#公司
            '''

        item=MyscrapyItem()
        item['gangwei'] = response.xpath("//div[@class='cn']//h1/@title").extract()[0].strip()
        yaoqiu = response.xpath("//div[@class='cn']//p[@class='msg ltype']/@title").extract()[0]
        item['yaoqiu'] = yaoqiu.split("|")[2].strip()
        try:
            item['xinchou'] = response.xpath("//div[@class='cn']//strong/text()").extract()[0].strip()
        except:
            item['xinchou'] = "面议"
        zhize = "".join(response.xpath("//div[@class='bmsg job_msg inbox']//p//b/text()|//div[@class='bmsg job_msg inbox']//p/text()").extract()).strip()
        if not zhize:
            zhize = "".join(response.xpath("//div[@class='bmsg job_msg inbox']//div/text()").extract()).strip()
        item['zhize'] = zhize
        qu = response.xpath("//div[@class='cn']//p[@class='msg ltype']/@title").extract()[0]
        item['diqu'] = qu.split("|")[0].strip()
        item['dizhi'] = response.xpath("//p[@class='fp']/text()").extract()[-1].strip()
        item['gongsi'] = response.xpath("//div[@class='cn']//a[@class='catn']/@title").extract()[0].strip()
        item['url'] = response.url
        yield item


    def spidererr(self,failure):
        '''
        def errback_httpbin(self, failure):
            # log all failures
            self.logger.error(repr(failure))

            # in case you want to do something special for some errors,
            # you may need the failure's type:

            if failure.check(HttpError):
                # these exceptions come from HttpError spider middleware
                # you can get the non-200 response
                response = failure.value.response
                self.logger.error('HttpError on %s', response.url)

            elif failure.check(DNSLookupError):
                # this is the original request
                request = failure.request
                self.logger.error('DNSLookupError on %s', request.url)

            elif failure.check(TimeoutError, TCPTimedOutError):
                request = failure.request
                self.logger.error('TimeoutError on %s', request.url)
        '''
        requests = failure.request
        url=requests.url
        self.logger.warning("statr_requests error:" + str(url))


        yield request


    def parseerror(self,failure):
        requests = failure.request
        url = requests.url
        self.logger.warning("statr_requests error:" + str(url))


        yield request










